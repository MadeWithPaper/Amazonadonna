matrix:
  include:
    - language: node_js
      node_js:
        - 'node'

      services:
        - docker
      before_install:
        - docker pull amazon/dynamodb-local
        - docker run -d -p 8000:8000 amazon/dynamodb-local

      before_script:
        - mkdir ~/.aws
        - cd API
        - cp ./credentials ~/.aws/
        - npm i

      script:
        - npm test
    - language: android
      sudo: true
      # env:
      #   global:
      #     - ANDROID_API=28
      #     - EMULATOR_API=24
      #     - ANDROID_BUILD_TOOLS=28.0.3

      android:
        components:
          # The BuildTools version used by project
          - tools
          - platform-tools
          - tools
          - build-tools-28.0.3
          # The SDK version used to complie project
          - android-28
          - android-24
          - extra-android-support
          - extra-google-m2repository
          - extra-android-m2repository
          - sys-img-armeabi-v7a-addon-google_apis-google-28
          - sys-img-armeabi-v7a-android-24

      licenses:
        - android-sdk-preview-license-.+
        - android-sdk-license-.+
        - google-gdk-license-.+

      jdk:
        - oraclejdk8

      # Emulator Management: Create, Start and Wait
      before_script:
        - echo "y" | android update sdk -a --no-ui --filter android-24
        - echo "y" | android update sdk -a --no-ui --filter sys-img-armeabi-v7a-android-24
        - android list targets
        - echo no | android create avd --force -n test -t android-24 --abi armeabi-v7a
        - emulator -avd test -no-window &
        - android-wait-for-emulator
        - adb shell input keyevent 82 &
        - ./gradlew clean build

      script:
        - ./gradlew connectedCheck
